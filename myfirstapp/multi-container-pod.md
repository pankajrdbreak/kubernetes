# Multi-container Pods

As name suggest a pod with more than one conatiner in it is called as Multicontainer pod.
The multi-container pods are the pods that contain two or more related containers that share resources like network space, shared volumes, etc and work together as a single unit. Basically, these helper processes or containers enhance the main containers by providing additional functionality.

In multicontainer pods there is content-generator which will create content continously and put it into shared volume and then this volume is accessed by main-container which will display the content.

The container is not get terminated after pulling the content.It will work as a side car for the main container


# Example
Pod with 2 containers one container is getting memory status and saves into shared volume on continous basis and that shared data is used by another container.

```console
apiVersion: v1
kind: Pod
metadata:
  name: multi-container-demo2
spec:
  containers:
  - name: data-displayer
    image: nginx:alpine
    ports:
    - containerPort: 80
    volumeMounts:
    - name: data-dir
      mountPath: "/usr/share/nginx/html"
  - name: data-provider
    image: busybox
    command: ['sh', '-c', 'while true; do echo $(free -m) >> /datadir/index.html && sleep 5; done']
    volumeMounts:
    - name: data-dir
      mountPath: "/datadir"
  volumes:
  - name: data-dir
    emptyDir: {}
```

Here the memory status content is generated by "data-provider" container and saves to /datadir in index.html file every 5 seconds.
The "data-displayer" container is serving the content of index.html from shared volume

```console
pankaj@kmaster:~/Desktop$ kubectl create -f multicontainerpod.yaml 
pod/multi-container-demo2 created
pankaj@kmaster:~/Desktop$ kubectl get pods -o wide
NAME                              READY   STATUS              RESTARTS   AGE   IP            NODE    NOMINATED NODE   READINESS GATES
html-webserver-5b459c9556-jgmzt   1/1     Running             5          10d   10.200.1.77   knode   <none>           <none>
html-webserver-5b459c9556-vf64q   1/1     Running             5          10d   10.200.1.74   knode   <none>           <none>
init-demo                         1/1     Running             0          34m   10.200.1.78   knode   <none>           <none>
multi-container-demo2             0/2     ContainerCreating   0          4s    <none>        knode   <none>           <none>
pankaj@kmaster:~/Desktop$ kubectl get pods -o wide
NAME                              READY   STATUS    RESTARTS   AGE   IP            NODE    NOMINATED NODE   READINESS GATES
html-webserver-5b459c9556-jgmzt   1/1     Running   5          10d   10.200.1.77   knode   <none>           <none>
html-webserver-5b459c9556-vf64q   1/1     Running   5          10d   10.200.1.74   knode   <none>           <none>
init-demo                         1/1     Running   0          34m   10.200.1.78   knode   <none>           <none>
multi-container-demo2             2/2     Running   0          13s   10.200.1.79   knode   <none>           <none>


pankaj@kmaster:~/Desktop$ kubectl describe pod multi-container-demo2
Name:         multi-container-demo2
Namespace:    default
Priority:     0
Node:         knode/172.16.230.137
Start Time:   Mon, 21 Jun 2021 15:06:05 +0530
Labels:       <none>
Annotations:  <none>
Status:       Running
IP:           10.200.1.79
IPs:
  IP:  10.200.1.79
Containers:
  data-displayer:
    Container ID:   docker://f8eff5633e293adf09ff426822c0620ee7512347c4a87d7fe120eadd75c63787
    Image:          nginx:alpine
    Image ID:       docker-pullable://nginx@sha256:0f8595aa040ec107821e0409a1dd3f7a5e989501d5c8d5b5ca1f955f33ac81a0
    Port:           80/TCP
    Host Port:      0/TCP
    State:          Running
      Started:      Mon, 21 Jun 2021 15:06:06 +0530
    Ready:          True
    Restart Count:  0
    Environment:    <none>
    Mounts:
      /usr/share/nginx/html from data-dir (rw)
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-jsqp5 (ro)
  data-provider:
    Container ID:  docker://dcde4e759da5d009e262b13806b5dafac7f61cf5ac742e651239040f4ebe38c0
    Image:         busybox
    Image ID:      docker-pullable://busybox@sha256:930490f97e5b921535c153e0e7110d251134cc4b72bbb8133c6a5065cc68580d
    Port:          <none>
    Host Port:     <none>
    Command:
      sh
      -c
      while true; do echo $(free -m) >> /datadir/index.html && sleep 5; done
    State:          Running
      Started:      Mon, 21 Jun 2021 15:06:12 +0530
    Ready:          True
    Restart Count:  0
    Environment:    <none>
    Mounts:
      /datadir from data-dir (rw)
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-jsqp5 (ro)
Conditions:
  Type              Status
  Initialized       True 
  Ready             True 
  ContainersReady   True 
  PodScheduled      True 
Volumes:
  data-dir:
    Type:       EmptyDir (a temporary directory that shares a pod's lifetime)
    Medium:     
    SizeLimit:  <unset>
  kube-api-access-jsqp5:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  3607
    ConfigMapName:           kube-root-ca.crt
    ConfigMapOptional:       <nil>
    DownwardAPI:             true
QoS Class:                   BestEffort
Node-Selectors:              <none>
Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
  Type    Reason     Age   From               Message
  ----    ------     ----  ----               -------
  Normal  Scheduled  42s   default-scheduler  Successfully assigned default/multi-container-demo2 to knode
  Normal  Pulled     41s   kubelet            Container image "nginx:alpine" already present on machine
  Normal  Created    41s   kubelet            Created container data-displayer
  Normal  Started    41s   kubelet            Started container data-displayer
  Normal  Pulling    41s   kubelet            Pulling image "busybox"
  Normal  Pulled     35s   kubelet            Successfully pulled image "busybox" in 5.744300884s
  Normal  Created    35s   kubelet            Created container data-provider
  Normal  Started    35s   kubelet            Started container data-provider
  
  
pankaj@kmaster:~/Desktop$ kubectl exec -it multi-container-demo2 -c data-displayer sh
kubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl exec [POD] -- [COMMAND] instead.
/ # curl 10.200.1.79
total used free shared buff/cache available Mem: 1958 811 217 8 929 972 Swap: 0 0 0
total used free shared buff/cache available Mem: 1958 804 223 8 930 979 Swap: 0 0 0
total used free shared buff/cache available Mem: 1958 804 223 8 930 979 Swap: 0 0 0
total used free shared buff/cache available Mem: 1958 804 223 8 930 979 Swap: 0 0 0
total used free shared buff/cache available Mem: 1958 804 223 8 930 979 Swap: 0 0 0
total used free shared buff/cache available Mem: 1958 804 224 8 930 980 Swap: 0 0 0
total used free shared buff/cache available Mem: 1958 804 223 8 930 980 Swap: 0 0 0
total used free shared buff/cache available Mem: 1958 804 223 8 930 980 Swap: 0 0 0
total used free shared buff/cache available Mem: 1958 805 222 8 930 979 Swap: 0 0 0
total used free shared buff/cache available Mem: 1958 804 223 8 930 980 Swap: 0 0 0
total used free shared buff/cache available Mem: 1958 805 222 8 930 979 Swap: 0 0 0
total used free shared buff/cache available Mem: 1958 804 223 8 930 980 Swap: 0 0 0
total used free shared buff/cache available Mem: 1958 806 221 8 930 978 Swap: 0 0 0
total used free shared buff/cache available Mem: 1958 806 220 8 930 978 Swap: 0 0 0
total used free shared buff/cache available Mem: 1958 807 220 8 930 978 Swap: 0 0 0
total used free shared buff/cache available Mem: 1958 806 220 8 930 978 Swap: 0 0 0
total used free shared buff/cache available Mem: 1958 806 220 8 930 978 Swap: 0 0 0
total used free shared buff/cache available Mem: 1958 808 218 8 930 976 Swap: 0 0 0
total used free shared buff/cache available Mem: 1958 809 217 8 931 975 Swap: 0 0 0
total used free shared buff/cache available Mem: 1958 810 216 8 931 975 Swap: 0 0 0
total used free shared buff/cache available Mem: 1958 808 219 8 931 977 Swap: 0 0 0
total used free shared buff/cache available Mem: 1958 807 219 8 931 977 Swap: 0 0 0
/ # 
```
